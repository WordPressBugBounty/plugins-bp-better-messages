!function(){var e=parseInt(Better_Messages.user_id),t,i=Better_Messages.oneSignalSdk||"";function n(){window.OneSignalDeferred=window.OneSignalDeferred||[],OneSignalDeferred.push((function(t){t.login(e.toString()),s(t),t.User.PushSubscription.addEventListener("change",(function(e){s(t)}))}))}function s(i){var n=i.User.PushSubscription.id,s=i.User.PushSubscription.optedIn;s&&n&&BetterMessages.getApi().then((function(s){BetterMessages.getSetting("oneSignal2025").then((function(o){var a=!1;o?(o.user_id!=e&&(a=!0),o.subscription_id!=n&&(a=!0)):a=!0,a&&(t&&clearTimeout(t),t=setTimeout((function(){s.post("oneSignal/updateSubscription",{subscription_id:n}).then((function(t){BetterMessages.updateSetting("oneSignal2025",{user_id:e,subscription_id:n})})).catch((function(e){console.error(e)}))}),3e3))}))}))}function o(){var i=function(){BetterMessages.getApi().then((function(i){BetterMessages.getSetting("oneSignal").then((function(n){var s=!1;OneSignal.getUserId().then((function(o){o&&(n?(n.user_id!=e&&(s=!0),n.subscription_id!=o&&(s=!0)):s=!0,s&&(t&&clearTimeout(t),t=setTimeout((function(){i.post("oneSignal/updateSubscription",{subscription_id:o}).then((function(t){BetterMessages.updateSetting("oneSignal",{user_id:e,subscription_id:o}),OneSignal.setExternalUserId(e)})).catch((function(e){console.error(e)}))}),3e3)))}))}))}))};OneSignal.push((function(){OneSignal.isPushNotificationsEnabled().then((function(e){e&&i()})),OneSignal.on("subscriptionChange",(function(e){e&&i()}))}))}i==="v16"?n():"undefined"!=typeof OneSignal&&"function"==typeof OneSignal.getUserId?o():n()}();
